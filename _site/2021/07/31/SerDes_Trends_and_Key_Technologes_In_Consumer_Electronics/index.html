<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="v0uNv3nx9jZLk-UxF0kPiGyotJ8tb-5YkP8IuUyUYsE" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="这里是马昭鑫的博客，用来记录平时一些乱七八糟的想法和总结。Keep thinking, keep moving.
">
    <meta name="keywords"  content="马昭鑫, MaZhaoxin
">
    <meta name="theme-color" content="#000000">
    
    <title>消费电子中SerDes的发展趋势和关键技术 - 马昭鑫的博客 | MaZhaoxin's Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2021/07/31/SerDes_Trends_and_Key_Technologes_In_Consumer_Electronics/">

    <!-- Bootstrap Core CSS -->
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="//cdn.staticfile.org/twitter-bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

	<!-- MathJax -->
	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	    tex2jax: {
	      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
	      processEscapes: true
	    }
	  });
	</script>
  	<!-- <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
	<script src="//cdn.staticfile.org/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">MaZhaoxin's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
					<li>
						<a href="#" id="cb-search-btn">SEARCH</a>
					</li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/bg-post/ic.jpg')
    }

    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Training" title="Training">Training</a>
                        
                        <a class="tag" href="/tags/#SerDes" title="SerDes">SerDes</a>
                        
                    </div>
                    <h1>消费电子中SerDes的发展趋势和关键技术</h1>
                    
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by MaZhaoxin on July 31, 2021</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<blockquote>
  <p>MediaTek再一次在东南大学和西安电子科技大学举办了暑期夏令营，今年的模拟IC部分由我来讲（之前的讲师没时间），PPT因为信息安全问题拿不出来，我就把讲稿整理了一下形成本文。</p>

  <p>这是第一部分的讲稿，第二部分是<a href="/2021/08/01/Reliability_and_ESD_Introduction/">可靠性与ESD介绍</a>。</p>
</blockquote>

<h3 id="1-标题">1. 标题</h3>

<p>大家好，欢迎各位同学参加暑期夏令营，在经过了几天Hardware、Software和Digital相关的学习后，今天我们换点不一样的，由我来给大家分享一下Analog部分。</p>

<p>我的题目是《消费电子中SerDes的发展趋势和关键技术》，提到“SerDes”大家可能或多或少地听说过，我希望通过本次分享可以一方面让大家更清晰地认识到SerDes是个什么东西，有哪些产品用的是SerDes技术，以及SerDes的发展趋势是怎样的。另一方面，考虑到同学们大多是Hardware和Digital背景，我会尽量讲一些浅显的、基础的内容，让大家对Analog的工作内容有个认识，明白Analog Designer所面临的困难和对应的解决方案是怎样的，理解为什么看起来很简单的东西Analog需要费那么大的劲去做。</p>

<h3 id="2-自我介绍">2. 自我介绍</h3>

<p>先做个自我介绍。我叫马昭鑫，来自合肥分公司模拟部门。2013年从中国科大硕士毕业后，先是到了海思的射频部门，给短距和手机的射频芯片做锁相环。三年半后回到合肥加入了联发科技，现在主要给SerDes做锁相环和时钟恢复。虽说以前做射频，现在做模拟，但其实二者的界限没有很明显，毕竟现在SerDes的工作频率不比射频低了。</p>

<h3 id="3-课程安排">3. 课程安排</h3>

<p>接下来我会用大约一个小时的时间给大家分享一下我对SerDes的理解。</p>

<h3 id="4-大纲">4. 大纲</h3>

<p>首先我会介绍一下什么是SerDes，然后带大家认识一下生活中可以见到的SerDes应用，再对其中我觉得比较重要的几项技术做一下分享，如果有什么问题可以在最后的Q&amp;A环节提问。</p>

<h3 id="5-什么是serdes">5. 什么是SerDes</h3>

<p>“SerDes”是一个合成词，表示“Serializer”和“Deserialzier”，即并转串和串转并，所以我们一般写的时候会把字母D大写。它的功能就像这幅动图表示的一样，发送端把并行的数据先转成串行，再通过信道发送；接收端在接收到数据后再转成并行格式，完成收发动作，就这么“简单”。</p>

<p>可能有人会问了：“先把并行的转成串行的，再把串行的转回并行的，这是吃饱了撑得吗？”当然不是，通过串行的方式发送数据主要有这么几个好处。</p>

<h3 id="6-为什么需要串行接口">6. 为什么需要串行接口</h3>

<p>首先来看最左边的这张图。这是PCB上的走线，为什么上面有很多弯弯绕绕的线？这是因为对于并行信号，我们要尽量保证每条信号的延时是相同的，这样才方便接收端接收信号，所以要走“等长线”。很显然这会增加PCB的走线复杂度，并且当频率高到一定程度时，线与线之间的失配会让准确接收信号变成不可能的事。而走串行信号就没这个困扰，一般只要走一对差分线就好。</p>

<p>其次是Pin的数量和成本。这是显而易见的事情，并行接口要用10个Pin，串行信号只需要2个，多8个Pin不仅是封装成本变高，在PCB上也需要更大的走线空间。更重要的是封装上可用Pin数量的增长速度远远比不上带宽需求的增长速度，后面我们会看到一些数据。</p>

<p>然后是功率效率，我们用每发送1bit信号所需要的能量评价。串行接口的效率远远好于并行接口，尤其是在通信速率较高的时候，稍后我们也会看到一些数据。</p>

<p>最后是电磁干扰，这在手机这类集成度非常高的系统中很重要。因为并行接口的信号幅度通常是轨到轨的，比如说0到1.8V；而串行接口的信号幅度可以比较小，比如说0.4V。信号幅度越小，对其他模块的干扰通常也会越小，并且差分信号接口又可以抑制共模干扰，这样在工作时既不会干扰别人，又不怕别人干扰。</p>

<h3 id="7-为什么需要串行接口续">7. 为什么需要串行接口（续）</h3>

<p>这里补充两组数据。左边的图是IO带宽和Pin的数量逐年变化的情况，很明显Pin的数量增长速度还不够快，毕竟这是受限于尺寸和密度的，而人们对带宽的需求增长得很快，相信大家这几年应该能感受得到。</p>

<p>右边的图横轴是每根Pin的数据率，黑色的是并行接口的功率效率，蓝色的是串行接口的。采用串行接口可以节省更多的功耗，这对于手机这类使用电池的移动设备来说有重要意义。其实对于大型机房里的设备来说这点也很重要，要知道机房的成本很大一部分是空调费，也就是用在了散热上。</p>

<h3 id="8-大纲">8. 大纲</h3>

<p>通过前面的内容，我们知道了什么是SerDes以及为什么要用SerDes，接下来让我们看看SerDes在哪些方面有着应用。</p>

<h3 id="9-在哪可以找到serdes">9. 在哪可以找到SerDes</h3>

<p>以这样一个家庭住址为例，我们从中可以看到哪些应用了SerDes的东西呢？（等10秒）</p>

<h3 id="10-在哪可以找到serdes续">10. 在哪可以找到SerDes（续）</h3>

<p>圈中的这些都是，比如摄像头、耳机、手机、智能音箱、电视、显示器、汽车等等。</p>

<h3 id="11-在哪可以找到serdes续">11. 在哪可以找到SerDes（续）</h3>

<p>可以说SerDes是无处不在的。接下来我会举两个例子详细说明一下。</p>

<h3 id="12-智能手机中的serdes">12. 智能手机中的SerDes</h3>

<p>首先从我们平时使用频率最高的手机说起。这是首发天玑1200的Realme手机，我们从它的规格可以看出商家和用户最关注的地方——好的屏幕、强劲的处理器、多颗高像素摄像头和大容量电池。<em>这款手机的性价比还是很高的，这么高的配置好像只要1600块钱就能买到，需要换机的同学可以考虑一下。</em></p>

<p>大家知道手机在摄像、拍照时数据要从摄像头传递到处理器，经过处理后再传到屏幕上进行显示，那么这条信号链路所需要的带宽有多少？1Gbps？10Gbps？我们试着来算一下。以2k屏幕来算，像素点数是1080*2040，色彩空间是8*3，再乘上刷新率120，再考虑到编码效率，最后得到的结果是——8Gbps。当然这个计算方法并不准确，因为没考虑到颜色格式和帧格式，只是让大家对数据率有个印象。要注意到这只是处理器到屏幕的数据量，这款手机还有3颗摄像头呢，可以想象处理器同一时间的数据吞吐量有多大、对IO带宽的需求有多大。</p>

<h3 id="13-智能手机中的serdes续">13. 智能手机中的SerDes（续）</h3>

<p>除了屏幕和摄像头，手机中还有很多SerDes接口，以MIPI联盟的这张图为例，我们从中可以看到用于存储的UFS接口、用于连接Modem的PCIe接口、用于连接RFIC的DigRF接口等。此外还有图中没显示的用于Memory的DDR接口，虽然这是个并行接口，但技术上其实与SerDes有很多共同之处。</p>

<p>我们从这些接口的应用中可以看出对SerDes的需求——数据率要高、功耗要小。</p>

<h3 id="14-电视中的serdes">14. 电视中的SerDes</h3>

<p>接下来让我们看一下另一个生活中比较常见的电子产品——电视。不知道大家有没有发觉，近几年电视的发展速度非常快，面板尺寸从原来的30多吋变成了60多吋，大家去京东、淘宝搜“电视”，会发现卖得最好的是55~65吋这个区间。更大尺寸的也在慢慢普及，比如80多吋。小米前些年甚至出了98吋的电视，荣耀最近好像也出了一款——这个尺寸放家里其实已经非常夸张了。</p>

<p><em>我记得之前发生过这么一件事，有个用户买了台98吋的电视，结果送货的时候发现居然连电梯都放不进去，最后是拿吊车给从阳台上吊进去的。雷军就发了条微博说谁买了这台电视，全小区都会认识你。</em></p>

<p>面板尺寸大了分辨率一定要高，否则离近了一看全是马赛克，所以4k、8k开始普及了。然后刷新率也要高，否则在小屏幕上看起来很平滑的移动，在大屏幕上因为移动的距离变远了看起来就会很不自然。即使信号源的帧率没那么高，电视自己也要插值把帧率提上去。还有其他功能也要跟上，色彩空间、HDR、3D等等……</p>

<h3 id="15-电视中的serdes续">15. 电视中的SerDes（续）</h3>

<p>我们来看这个框图，信号源通过线缆把信号发到电视的处理器上，处理完后再把信号发到面板上，画面才能显示出来。其中就会用到HDMI和VBO两个SerDes接口，从之前算手机的带宽需求也不难看出，电视所需要的带宽更大，比如HDMI 2.1已经可以支持到48Gbps的数据率。</p>

<p>电视相对手机还有个特点——大，或者说是信号路径长。手机最多也就十几厘米，而HDMI线有两三米长，面板上的走线也有一两米，这对SerDes的要求是——不仅要传得快，还要传得远。<em>MediaTek现在做的HDMI 2.1接口可以支持5米长的线，这有什么好处？这样就可以用投影了仪，因为投影仪通常要放到客厅的另一面墙那嘛。</em></p>

<h3 id="16-serdes标准">16. SerDes标准</h3>

<p>好了，我们不再一一举例，直接来看这幅图：横轴是时间，纵轴是数据率，不同颜色的点是不同的协议标准。从中我们可以看到很多熟悉的标准：比如攒机的同学会非常熟悉的PCIe接口，一般用来接显卡，现在也会用来接固态硬盘什么的；比如USB，现在几乎一统天下了，传数据、充电都可以用；还有显示器上都会有的DP接口等等。从这张图上不难看出，各SerDes标准的数据率越来越高，呈指数级增长，这就为我们的电路设计提出了很大的挑战。</p>

<h3 id="17-大纲">17. 大纲</h3>

<p>接下来就让我们看一下困难点在哪，以及如何应对。</p>

<h3 id="18-框图">18. 框图</h3>

<p>让我们再深入地看一下SerDes，发送端包括并转串电路和驱动器，二者在锁相环提供的时钟驱动下把数据送到信道中，接收端会先做均衡——等下我会解释这是什么——然后进行采样，最后经过串转并电路恢复成原数据，在接收端会有时钟恢复模块自动寻找最佳的采样时刻，就像右下角的时序图示意的那样。</p>

<h3 id="19-典型场景">19. 典型场景</h3>

<p>在实际应用中，无论中间是线缆还是PCB走线，信号一定是从一颗芯片经过封装、PCB走线等一系列路径走到另一颗芯片里面，这条路径上会产生损耗、反射、串扰等。一个典型的信道的频率响应曲线就如右边的图所示，一般频率越高损耗越大，实际的情况还要与路径的长短、材质有关。信号经过这条路径后会发生一定的畸变。</p>

<h3 id="20-波形">20. 波形</h3>

<p>一个这样的波形从发射端出来，经过前面那样的信道会变成什么样子呢？我们可以想到高频部分被衰减、低频部分会被保留，一组方波信号到了接收端就会变成这样子……感受一下，这个可能跟做数字电路的同学的认知不太一样，但真实的波形就是这样，不能说面目全非吧，但已经被磨平了棱角，看不太出来原先的信号了。当然这是在衰减比较大的情况下，如果衰减小一些还是能看出来的。那么问题就来了，如何<strong>定量</strong>地评价信号的质量呢？</p>

<h3 id="21-眼图">21. 眼图</h3>

<p>我们引入“眼图”这个概念。眼图的获取方式很简单，先采集到波形，然后把波形分成小份，再叠加在一起，就会得到右上角的这幅图。这幅图的中间好像是一只眼睛，因此称作“眼图”。眼的大小决定了采样时的裕度，我们希望眼越大越好。</p>

<p>定量的说就是眼高和眼宽，眼宽大小意味着采样的时候对时钟位置的要求高低，眼高大小意味着对比较器容限的要求高低，翻译成更直白的话就是：眼越大采样的时候就越不容易出错。SerDes协议在制定标准时会把眼图作为很重要的一个兼容测试项。</p>

<p>让我们仔细地看一下这幅眼图，因为后面会频繁地用到。你会发现它是由很多条线组成的，这一幅图里包含了2个单位间隔、3个bit值、8种可能的组合，决定眼大小的是101和010两个组合，不过这个并不绝对，可能有的场景是其他的组合限制了。</p>

<h3 id="22-信道损耗">22. 信道损耗</h3>

<p>好了，我们回顾一下，免得出现那种<em>低头捡了只笔，结果这门课就再也没听懂过</em>的情况发生。</p>

<p>我们知道了SerDes通信归根到底是两颗芯片里面的电路通过一系列路径，也就是信道，收发信号的过程。波形通过信道后会发生畸变，畸变的程度可以通过眼图里眼的大小进行判断，只有眼睛睁开才能正确地接收到信号，眼睛越大抗干扰能力就越强，而信道的衰减越大眼睛就闭合的越厉害。</p>

<p>比如这两幅图，一个是2Gbps，信道衰减大约是6dB，另一个是5Gbps，信道衰减大约是12dB，两个眼图就会差这么多。现在思考一下，为什么会这样？</p>

<h3 id="23-码间干扰">23. 码间干扰</h3>

<p>让我们引入码间干扰的概念。傅里叶变换告诉我们，时域与频域存在着对偶性，时域越窄对应的频域越宽，而频域越窄对应的时域就会越宽。当一个窄脉冲信号通过有限带宽的信道后会被展宽，就像左边这张图所表示的。而对于一个线性时不变系统，一系列信号经过系统后的输出，与信号一部分一部分地通过系统再叠加在一起的效果是一样的。我们来看一下右边这幅图，发送端送出来的信号是101，前面的1产生的响应是红色的线，后面的1产生的响应是蓝色的线，二者相加是黑色的线。当用中间电平作为阈值去判别数据时会发现中间这个0就被误判成了1，产生了误码。这就叫码间干扰，总结一下就是前一bit残留的状态影响了后续的bit。</p>

<h3 id="24-均衡">24. 均衡</h3>

<p>我们知道了码间干扰是造成眼图闭合的直接原因，而根本原因是信道衰减导致的有限带宽。那么如何解决这个问题呢？</p>

<p>一般来说走线越长衰减越厉害，那走短点线或者用一些好材质的线能不能解决问题？能，但是很难实现，因为客户的需求我们是改变不了的。</p>

<p>那因为带宽太窄才会造成这个问题，如果我们想个办法让带宽变宽点行不行？行！怎么做？我们可以做一个滤波器，串在信道上，让滤波器的频率响应正好跟信道本身的响应相反，抑制低频、增强高频，使得整体的带宽是宽的。这样就可以改善码间干扰，让眼图张开。</p>

<p>那直接从码间干扰下手行不行？也行。因为我们可以想办法得到信道引起的码间干扰，当接收到一个信号后便可以知道它对后续的bit会产生什么样的影响，我们直接把这个影响减掉就可以了。</p>

<p>这两种方法都称作“均衡”。</p>

<h3 id="25-均衡续">25. 均衡（续）</h3>

<p>均衡可以做在发射端，也可以做在接收端。常见的方法如图所示：在发射端做的是前馈均衡器FFE，按照实现方式又有预加重和去加重两种；在接收端做的有连续时间线性均衡器CTLE和判决反馈均衡器DFE，现在有的也会在接收端加个FFE进一步增强均衡效果。接下来我们逐一看一下。</p>

<h3 id="26-均衡---ffe">26. 均衡 - FFE</h3>

<p>前馈均衡器FFE的实现方式非常简单，如左图所示，这是一个3阶有限冲击响应滤波器，它的输出如中图所示，右图所示的是原先的眼图和使用均衡器后的眼图的对比。从中图不难看出，在信号跳变时波形会先往反方向跳一下，以增大跳变的幅度。<em>打个比方，如果你想把一根有弹性的铁丝弯成90度需要怎么做？会先把它弯得比90度更厉害，然后松手让它自己回弹到90度的位置。FFE的做法是类似的，既然信道会把边沿变得平缓，那么我就把边沿变得更加陡峭，这样经过信道后仍然可以保持原有的样子。</em>如果从频域或者码间干扰的角度看，就是前面（第24页）右图的样子，这个滤波器的频率响应是红色的线，信道的频率响应是蓝色的线，二者叠加就成了绿色的线，显然叠加后的带宽被大大增加了，码间干扰也会大大减小。</p>

<p>这种结构的优点是简单，只需要对信号做延时，然后乘以相应的系数后加在一起就可以了，在模拟电路上乘不同的系数就是驱动不同大小的电流，相加就是直接把输出接在一起，非常容易实现。但是它的缺点是会减小低频的增益，我们从波形也很容易看出，发送长0或长1时输出幅度只有这么大；观察眼图也可以看出来，原先有0.8V的幅度，现在只有0.2V了。这种保持最大幅度、减小长0长1幅度的做法称作“去加重”。如果是保持长0长1的幅度、在信号跳变时额外增加波形幅度的做法称作“预加重”，这种做法虽然不会降低低频处的幅度，但是会给可靠性带来压力，下次分享我会讲到原因。</p>

<h3 id="27-均衡---ffe续">27. 均衡 - FFE（续）</h3>

<p>在近几年MediaTek发表的ISSCC中一直采用左图所示的FFE，因为它的驱动器是DAC结构的，所以可以直接用数字电路实现FFE。从右图的对比表格可以看到现在高性能的SerDes普遍会使用3~4阶的FFE。</p>

<p>另外大家注意一下，这部分电路的工作频率是多少？工作频率就是数据率，一般是5GHz以上，对于论文中的这些SerDes会达到50GHz、100GHz。<em>有不少同学是做Digital的，你能想象一块数字电路的工作频率是上百GHz吗？这一定需要非常先进的工艺支持，也就是很多人说的“SerDes非常吃工艺”。所以各位同学如果想做一些高性能的东西，一定要选好平台，比如MediaTek这种，否则空有想法实现不了。</em></p>

<h3 id="28-均衡---ctle">28. 均衡 - CTLE</h3>

<p>让我们再来看连续时间均衡器CTLE，它的思路同样是在信道上串一个增强高频增益的滤波器，与前面FFE的区别在于它是工作在连续时间域的。一种典型的实现方式如左图所示，源端的电阻电容构成零点，抬高了高频处的增益。右图即为使用CTLE前后的眼图对比，注意看眼图高低与FFE的区别，CTLE的更高，这是因为它能提供一定的增益。CTLE的缺点是它在放大信号的同时也会放大噪声，另外因为零点的位置是由电阻电容决定的，而电阻电容是会随着工艺偏差变化的，就会导致补偿的效果像中图一样发生改变，在实际应用中还需要进行矫正。</p>

<h3 id="29-均衡---ctle续">29. 均衡 - CTLE（续）</h3>

<p>这是MediaTek在去年和今年发表的ISSCC，可以看到不仅放了CTLE，还放了可变增益放大器VGA来进一步抵消损耗的影响。因为它是用ADC做采样器，因此还可以在数字域用FFE进一步增大高频增益，从对比表格里也可以看到这是100Gbps高速SerDes的主流做法。而今年发的ISSCC中提到的CTLE的做法比较有趣，我就把它贴了出来，它不是采用前面我们提到的源级反馈放大器结构，而是利用延时相减的结构。它们本质的原理是一样的，目的都是要增大高频增益，算得上是一种“条条大路通罗马”，感兴趣的同学可以去看一下这篇论文，这里就不展开讲了。</p>

<h3 id="30-均衡---dfe">30. 均衡 - DFE</h3>

<p>接下来是判决反馈均衡器DFE，它与前两个的区别在于这不是一个线性均衡器，它的原理是假设我已经得到了当前信号，并推断出这个信号会引入的码间干扰，那么就可以在接下来的过程中减掉它所引入的码间干扰，这样就直接拉开了眼图。它的实现方式就如左图所示，把采样得到的信号通过滤波器反馈回来，如果滤波器的频率响应与信道相当，那么它们引入的码间干扰会直接抵消掉。中图是脉冲响应，原本的响应曲线是这样的，使用了DFE后可以把后两个采样时刻的码间干扰直接拉成0，所以在看眼图是可以看到在中间会跳一下。</p>

<p>这种均衡器的优点是不会放大噪声，但也有很明显的缺点，大家能看出来吗？判据反馈均衡器必须要在判决后才能施加影响，那么对于判决前的码间干扰是无能为力的。另外它也会让相位检测变得复杂，而相位检测是做时钟恢复的基础，等下我们会讲到。<em>如果说通过学习这种均衡器的原理能给我带来一些启发的话，我想是做模拟的也要了解一些数字的知识，做数字的也可以在模拟领域找到自己的应用。尤其是当集成电路设计发展了这么多年，很多问题需要模拟和数字共同合作才能解决。</em></p>

<h3 id="31-均衡---dfe续">31. 均衡 - DFE（续）</h3>

<p>让我们看一下发表的论文，1~3阶的DFE都有应用。今年有篇ISSCC的做法跟以往不太一样，它是通过两条路径相加去实现的，乍一看跟FFE有点像。但仔细看就会发现它的本质仍然是把采样后的结果拿回来去跟原来的信号做运算，原理是一样的，只是换了种做法。</p>

<p>好了，我们小结一下，前面一共提到了3种均衡方法，前两种是通过往信道里串滤波器的方法展宽总体的带宽，最后一种是直接从码间干扰下手，前两种的区别是FFE是离散时间域的，CTLE是连续时间域的。</p>

<p>如果在使出这三种均衡技术后眼图还是不够好怎么办？<em>跟客户说做不了？不好吧，最多可以跟客户说这个不好做，<strong>得加钱</strong>！</em>我们前面看信道的频率响应曲线时有看到频率越高衰减越厉害，那么能不能在保持数据率不变的前提下减小信号的频率？</p>

<h3 id="32-pam-4">32. PAM-4</h3>

<p>之前的码型我们称之为非归零码NRZ，它是取整个电压范围的最大和最小两个档位来标记数据，我们还可以称之为PAM-2，这里的“PAM”是脉冲幅度调制的意思。PAM-2每个符号能发送1bit信息。如果我们把电压范围分细一点，分出来4个档位，那么每个符号就可以发送2bit信息了，这就叫PAM-4。由于PAM-4每个符号可以携带两倍的信息，那么在数据率不变的情况下可以减半信号频率。</p>

<p>采用这种码型除了接收端至少需要用3个比较器来判决信号外，眼高会变成原先的1/3，真的能改善眼图吗？</p>

<h3 id="33-眼图对比">33. 眼图对比</h3>

<p>这不一定。这页PPT所示的是两种不同的信道下，使用NRZ和PAM-4时的眼图对比。可见在衰减较大时PAM-4才能展现出相对NRZ的优势。目前消费电子里PCIe Gen6才会用到PAM-4，到时候的工作频率会达到64GHz，其他的标准还没跟进这么快。但是应用PAM-4应该是早晚的事，毕竟铜介质的物理特性就在那里，只要数据率不断提升，迟早需要用到PAM-4。</p>

<p>前面我们讲的内容都是基于发送的信号是理想的情况下进行的，但现实中还会有其他因素导致眼的压缩，接下来我们介绍影响眼宽的重要因素——抖动。</p>

<h3 id="34-抖动">34. 抖动</h3>

<p>前面介绍时我们认为波形跳变的时刻是理想的、均匀的，但可惜实际上驱动电路工作的时钟存在着抖动。抖动的意思是时钟的沿出现的位置相对于理想位置会有偏差，可能会早一点出现，也可能会晚一点出现。这点做数字的同学应该比较熟悉了，你在算建立保持时间时就要考虑到抖动带来的影响。对于SerDes来说是相似的，时钟决定了波形跳变的时刻，如果时钟出现晃动那么波形的跳变位置也会跟着晃动，体现在眼图上就是眼宽被压缩了。</p>

<p>我们把眼图从中间横着切一刀，把信号与这一刀的交点用直方图的方式画出来就得到了这一个图，据此可以进行一些分析。</p>

<h3 id="35-抖动续">35. 抖动（续）</h3>

<p>抖动有很多产生原因，有的与发送的数据相关，比如说码间干扰、串扰，而有的是时钟自身带的，比如说随机抖动RJ、正弦抖动SJ等。其中随机抖动比较特殊，一般假设它是由器件的闪烁噪声、热噪声引起的，呈高斯分布，并且是无边界的，即样本数越大随机抖动的范围就越大，所以一般我们讲它的均方根值。在具体到一定误码率时再乘以相应的系数得到峰峰值，比如误码率是1e-12时系数是14.069，就意味着对于1e12个样本，随机抖动引入的抖动范围大约是其均方根值得14.069倍。</p>

<h3 id="36-误码率与浴缸曲线">36. 误码率与浴缸曲线</h3>

<p>由于眼宽等于单位间隔减去总的抖动TJ，而TJ中RJ的贡献与误码率有关，因此可以得到右边这张图，表示眼宽随着误码率变化的情况。显然相同的RJ下对误码率的要求越高眼宽越小，或者说相同的眼宽下对RJ的要求越高，那么如何提供一个稳定的时钟呢？</p>

<h3 id="37-锁相环">37. 锁相环</h3>

<p>我们都知道现代的集成电路里都会用到时钟，并且各系统的时钟频率还各不相同，那么怎么产生这些时钟呢？答案就是锁相环，它的原理是输入一个低频时钟，通过环路控制内部的振荡器产生高频时钟，高频时钟是低频时钟的N倍，这个N既可以是整数也可以是小数。低频时钟信号通常来自晶体振荡器，它的频率非常稳定，那么通过调整倍数N即可获得我们想要的时钟频率。<em>不知道有没有同学搞过CPU超频，其中就有步骤去调这个N值。</em></p>

<h3 id="38-锁相环中的噪声贡献">38. 锁相环中的噪声贡献</h3>

<p>我们前面提到过集成电路中的器件会贡献噪声，对于锁相环来说不同位置的模块所贡献的噪声是不同的。这张图所表示的就是锁相环的线性模型和噪声源，输入的参考时钟的高频噪声会被环路滤除，低频噪声会被保留和放大；而振荡器的高频噪声会直接输出，低频噪声会被环路抑制。因此为了得到性能最佳的时钟，我们需要合理地选择环路参数，在几个噪声源之间取折中。</p>

<p>在高速SerDes中留给RJ的空间越来越小，但先进工艺的器件噪声却越来越大，因此高速SerDes中低噪声锁相环的设计是一个难点。这里就不展开讲了，对锁相环感兴趣的同学可以深入地学习一下相关内容。</p>

<h3 id="39-展频时钟">39. 展频时钟</h3>

<p>前面我们提到过，在手机这种集成度很高又有射频系统的设备中，电磁干扰是一个很麻烦的事情，尤其是现在高速SerDes的速度已经达到了射频范围，因此还需要一定的方式进一步改善电磁干扰。展频时钟的原理是让时钟频率在一定范围内来回改变，相当于把原先集中在一个频点的能量分配到一个频率区间，这样体现出的平均功率密度就会低不少。具体的实现方式就是动态的改变锁相环中的倍频比N，先在数字域实现一个锯齿波发生器，然后通过锁相环的接口动态改变环路分频比，锁相环输出的时钟频率也就会跟着调整了。</p>

<h3 id="40-时钟恢复">40. 时钟恢复</h3>

<p>前面简单的讲了下发送端的时钟技术，现在再来看一下接收端的。对于接收端来说，需要在合适的位置对信号进行判决，就像图示的那样。但是由于码间干扰、串扰的影响，以及发送端时钟的抖动和故意加上的展频，怎么才能保证判决的位置是合适的呢？</p>

<h3 id="41-时钟恢复续">41. 时钟恢复（续）</h3>

<p>与锁相环类似，都是用到了锁相技术。在实现上有多种结构，比较常见的是基于锁相环的和基于相位内插的。基于锁相环的原理是通过相位检测器产生的信号调整振荡器的频率，而基于相位内插的是直接调整时钟的相位，二者各有利弊，目前的应用都很广泛。此外还有基于延迟锁相环DLL的、盲采的，甚至还有全数字的结构等等，感兴趣的同学可以深入了解一下，这里就不展开讲了。</p>

<h3 id="42-工程事务">42. 工程事务</h3>

<p>除了前面提到的这些技术，在工程上还有很多事情需要处理，比如各种矫正算法、高速逻辑电路设计、技术选型、电源划分、可靠性等等。<em>只有这些都做好了，客户才能拿到好用、经用的产品。</em></p>

<h3 id="43-总结">43. 总结</h3>

<p>最后做一个总结，在前面的分享中我主要提到了均衡器和时钟产生电路两部分，而在整个SerDes TRx架构中，还有一些高速逻辑、驱动器、Termination等电路，以及矫正算法、协议的控制等数字模块，这里因为时间问题就不多讲了。</p>

<h3 id="44-问答环节">44. 问答环节</h3>

<p>谢谢各位的听讲，如果有什么问题，请示意我。</p>

<blockquote>
  <p>后记：</p>

  <p>因为现在做Analog的学生不多，其中又有不少是做Power和Converter的，在东南那场中大多数同学都听得一头雾水，如果下次还需要我讲的话，我会把内容往与Digital/Hardware合作的部分靠。</p>
</blockquote>


                <hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2021/07/04/Nine_Types_Oscillator/" data-toggle="tooltip" data-placement="top" title="振荡器九宫格">
                        Previous<br>
                        <span>振荡器九宫格</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2021/08/01/Reliability_and_ESD_Introduction/" data-toggle="tooltip" data-placement="top" title="可靠性与ESD介绍">
                        Next<br>
                        <span>可靠性与ESD介绍</span>
                        </a>
                    </li>
                    
                </ul>


                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
                				<a href="/tags/#MATLAB" title="MATLAB" rel="4">
                                    MATLAB
                                </a>
                            
        				
                            
                				<a href="/tags/#PLL" title="PLL" rel="11">
                                    PLL
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Programing" title="Programing" rel="4">
                                    Programing
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#Math" title="Math" rel="2">
                                    Math
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Others" title="Others" rel="2">
                                    Others
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Flask" title="Flask" rel="2">
                                    Flask
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Training" title="Training" rel="2">
                                    Training
                                </a>
                            
        				
                            
                				<a href="/tags/#SerDes" title="SerDes" rel="2">
                                    SerDes
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#ChatGPT" title="ChatGPT" rel="2">
                                    ChatGPT
                                </a>
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="#">(none)</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<!--
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
-->
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/(none)">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/(none)">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/(none)">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/%E6%98%AD%E9%91%AB-%E9%A9%AC-96023bb7">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; MaZhaoxin's Blog 2024
                    <br>
					Powered by <a href="https://jekyllrb.com/" style="font-weight: bold">Jekyll</a> |
					Themed by <a href="http://huangxuan.me" style="font-weight: bold">Hux</a> |
					Hosted by <a href="https://pages.github.com/" style="font-weight: bold">GitHub Pages</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<!-- <script src="/js/jquery.min.js "></script> -->
<script src="//cdn.staticfile.org/jquery/2.1.3/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<!-- <script src="/js/bootstrap.min.js "></script> -->
<script src="//cdn.staticfile.org/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Jekyll Search -->
<div class="cb-search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
      opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
    <input type="text" class="form-control cb-search-content" id="cb-search-content" style="position: fixed; top: 60px" placeholder="Title / Date / Tags" >

    <div style="position: fixed; top: 16px; right: 16px;">
        <img src="/search/img/cb-close.png"  id="cb-close-btn"/>
    </div>
</div>

<link rel="stylesheet" href="/search/css/cb-search.css">

<script src="/search/js/bootstrap3-typeahead.min.js"></script>
<script src="/search/js/cb-search.js"></script>


</body>

</html>
