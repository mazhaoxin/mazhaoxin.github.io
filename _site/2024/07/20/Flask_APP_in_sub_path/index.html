<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="v0uNv3nx9jZLk-UxF0kPiGyotJ8tb-5YkP8IuUyUYsE" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="这里是马昭鑫的博客，用来记录平时一些乱七八糟的想法和总结。Keep thinking, keep moving.
">
    <meta name="keywords"  content="马昭鑫, MaZhaoxin
">
    <meta name="theme-color" content="#000000">
    
    <title>Flask App部署在子路径下的方法 - 马昭鑫的博客 | MaZhaoxin's Blog</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4000/2024/07/20/Flask_APP_in_sub_path/">

    <!-- Bootstrap Core CSS -->
    <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="//cdn.staticfile.org/twitter-bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.min.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.css">

	<!-- MathJax -->
	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	    tex2jax: {
	      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
	      processEscapes: true
	    }
	  });
	</script>
  	<!-- <script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> -->
	<script src="//cdn.staticfile.org/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">MaZhaoxin's Blog</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
					<li>
						<a href="#" id="cb-search-btn">SEARCH</a>
					</li>
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <!-- Post Header -->
<style type="text/css">
    header.intro-header{
        position: relative;
        background-image: url('/img/bg-post/coding.jpg')
    }

    
</style>
<header class="intro-header" >
    <div class="header-mask"></div>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/#Programing" title="Programing">Programing</a>
                        
                        <a class="tag" href="/tags/#Flask" title="Flask">Flask</a>
                        
                    </div>
                    <h1>Flask App部署在子路径下的方法</h1>
                    
                    
                    <h2 class="subheading"></h2>
                    
                    <span class="meta">Posted by MaZhaoxin on July 20, 2024</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <!-- Multi-Lingual -->
                

				<blockquote>
  <p>之前提到，我基于Flask做了个简单的微博部署在了NAS上。如今已过了3年，当我想再加个应用时遇到了困难，因为域名只有一个，要怎么映射到多个站点上呢？如果站点的技术栈不同，有没有统一的部署方式？</p>
</blockquote>

<h2 id="nginx">Nginx</h2>

<p>Nginx的鼎鼎大名自然早有耳闻，但一直不知道有什么用。好像每次听到这个词，都会跟“负载均衡”、“反向代理”之类的词一起出现。就像有人说过的，“人们对名字的恐惧，超过了这个名字代表的事物”。</p>

<p>经过查询学习，了解到Nginx其实就相当于“银行网点的大堂经理”，当顾客（访问）到来时先看一下他要办什么业务，简单的业务（如图片之类的静态文件）就当场办理，复杂的业务（涉及到计算处理的）再根据业务类型分配到对应的柜台。</p>

<p>想一下我要实现什么效果：</p>

<ol>
  <li>基于Flask的App不需要考虑自己会部署在哪个路径下，无论是根路径（<code class="language-plaintext highlighter-rouge">http://host/</code>）还是子路径（<code class="language-plaintext highlighter-rouge">http://host/app/</code>）都可以显示正确的画面、链接；</li>
  <li>当用户访问时，通过<code class="language-plaintext highlighter-rouge">http://host/app1/</code>可以访问App1，通过<code class="language-plaintext highlighter-rouge">http://host/app2/</code>可以访问App2，无论App1和App2是用什么语言、框架实现的。</li>
</ol>

<p>Nginx这个大堂经理能起到分配业务作用的前提是，App1和App2已经开好了柜台，也就是它们有各自的访问端口，如：App1部署在<code class="language-plaintext highlighter-rouge">http://localhost:5001</code>上，App2部署在<code class="language-plaintext highlighter-rouge">http://localhost:5002</code>上。</p>

<p>接下来便是设置Nginx，制定分配规则。在安装完成后，有个自动生成的配置文件在<code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/default</code>，只需要在其中再添加一条规则即可。</p>

<div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">location</span> <span class="n">/app1/</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:5001/app1/</span><span class="p">;</span>
        <span class="kn">proxy_redirect</span> <span class="no">off</span><span class="p">;</span>

        <span class="kn">proxy_set_header</span> <span class="s">Host</span> <span class="nv">$host</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Real-IP</span> <span class="nv">$remote_addr</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Proto</span> <span class="nv">$scheme</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>这条规则的含义是把向<code class="language-plaintext highlighter-rouge">http://host/app1/*</code>的请求都转发到<code class="language-plaintext highlighter-rouge">http://127.0.0.1:5001/app1/*</code>，这是与具体的语言、框架无关的。<em>其中转发到的<code class="language-plaintext highlighter-rouge">/app1/</code>在我的需求中是必要的，在其他需求场景下可能不是，要具体情况具体分析。</em></p>

<p>看起来，用子路径访问不同应用的需求已经解决了……吗？试一下发现并没有，App1提供的返回首页的链接会是<code class="language-plaintext highlighter-rouge">http://host/</code>而不是<code class="language-plaintext highlighter-rouge">http://host/app1/</code>，因为它不知道自己被部署到了子路径下面。</p>

<h2 id="wgsi">WGSI</h2>

<p>WGSI = Web Server Gateway Interface，它不是服务器，仅针对Python定义的一种接口规范（协议）。在这个协议框架下有服务器（Server）和应用（Application，App）两个组成部分：</p>

<ul>
  <li>Server的实现有uWSGI、<strong>Gunicorn</strong>等；</li>
  <li>Application的实现有Django、<strong>Flask</strong>等。</li>
</ul>

<p>在WGSI协议中有一个<em>意义不明</em>的<code class="language-plaintext highlighter-rouge">SCRIPT_NAME</code>参数，根据文档<a href="https://wsgi.readthedocs.io/en/latest/definitions.html">Definitions of keys and classes — WSGI.org</a>中的说明，App可以通过这个参数<strong>知道</strong>自己的虚拟位置。它默认是个空字符串（<code class="language-plaintext highlighter-rouge">""</code>），代表了根路径（<code class="language-plaintext highlighter-rouge">/</code>）。</p>

<blockquote>
  <p><strong>SCRIPT_NAME</strong></p>

  <p>The initial portion of the request URL’s “path” that corresponds to the application object, so that the application knows its virtual “location”. This may be an empty string, if the application corresponds to the “root” of the server.</p>
</blockquote>

<p>那么显然，在部署时把这个参数设置为<code class="language-plaintext highlighter-rouge">"/app1"</code>就可以了。</p>

<blockquote>
  <p>分享个失败的经验，如果误把<code class="language-plaintext highlighter-rouge">SCRIPT_NAME</code>设置成<code class="language-plaintext highlighter-rouge">"/app1/"</code>（多了个反斜线），在访问<code class="language-plaintext highlighter-rouge">http://host/app1/</code>时会出现重定向的死循环。</p>
</blockquote>

<h2 id="gunicorn">Gunicorn</h2>

<p>Gunicorn可以用文件进行配置，这个配置文件是个Python脚本，其中标<code class="language-plaintext highlighter-rouge">important</code>的两行非常重要。</p>

<ul>
  <li>前者决定了柜台开在哪，要与大堂经理（Nginx）的认知（配置文件）一致；</li>
  <li>后者则是子路径的设置。</li>
</ul>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># gunicorn.conf.py
</span><span class="n">workers</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">threads</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">bind</span> <span class="o">=</span> <span class="s">'127.0.0.1:5001'</span>         <span class="c1"># important
</span><span class="n">raw_env</span> <span class="o">=</span> <span class="p">[</span><span class="s">'SCRIPT_NAME=/app1'</span><span class="p">]</span> <span class="c1"># important
</span>
<span class="n">accesslog</span> <span class="o">=</span> <span class="s">'/var/log/gunicorn_access.log'</span>
<span class="n">errorlog</span> <span class="o">=</span> <span class="s">'/var/log/gunicorn_error.log'</span>
<span class="n">loglevel</span> <span class="o">=</span> <span class="s">'warning'</span>
</code></pre></div></div>

<p>启动Gunicon的命令为<code class="language-plaintext highlighter-rouge">/srv/web/bin/gunicorn -c ./gunicorn.conf.py run:app</code>，此时柜台便已开好。</p>

<h2 id="flask">Flask</h2>

<p>让我们回顾一下：</p>

<ol>
  <li>用户访问<code class="language-plaintext highlighter-rouge">http://host/app1/</code>，Nginx会接收请求；</li>
  <li>Nginx将请求转发给<code class="language-plaintext highlighter-rouge">http://127.0.0.1:5001/app1/</code>，Gunicorn会接收请求；</li>
  <li>Gunicorn知道自己被部署在<code class="language-plaintext highlighter-rouge">/app1/</code>下面，于是把前缀<code class="language-plaintext highlighter-rouge">/app1</code>从请求中拿掉（如果直接访问<code class="language-plaintext highlighter-rouge">http://127.0.0.1:5001/</code>会因为无法去除前缀而报错），再发给Flask处理；</li>
</ol>

<p>Flask照常解析、路由即可，但是页面中的链接要怎么保证是正确的呢？</p>

<p>显然，写死（hard-coding）的部分是无法正确处理的。而通过<code class="language-plaintext highlighter-rouge">url_for()</code>函数生成的链接，可以读取<code class="language-plaintext highlighter-rouge">SCRIPT_NAME</code>的设置，自动加上前缀，从而保证链接是正确的。也就是说，Flask App能正常运行还需要一个前提——<strong>无论是js、css、image之类的静态文件，还是页面之间的链接，都要用<code class="language-plaintext highlighter-rouge">url_for()</code>生成。</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"{ { url_for('static', filename='css/bootstrap.min.css') }}"</span><span class="nt">&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"navbar-brand"</span> <span class="na">href=</span><span class="s">"{ { url_for('index') }}"</span><span class="nt">&gt;</span>App Home<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>此处还踩了一个坑：Flask配置参数中有个<code class="language-plaintext highlighter-rouge">APPLICATION_ROOT</code>看起来更“浓眉大眼”一些，实际上它也能为<code class="language-plaintext highlighter-rouge">url_for()</code>生成的链接添加前缀，但它并不能实现我想要的效果。<em>好像是它仅在请求外才能生效，用<code class="language-plaintext highlighter-rouge">with app.test_request_context()</code>测试是可以工作，在实际使用时却没生效，没有细究原因。</em></p>
</blockquote>

<h2 id="总结">总结</h2>

<p>总结一下，其实Flask App还是会知道自己被部署到哪里，只是根据协议可以在不改动代码的方式，通过外部参数调整输出。Nginx作为直面用户的一环，根据链接模式（pattern）将请求转发到正确的端口。Gunicorn作为中间层负责处理请求地址并把参数告知Flask，Flask在用<code class="language-plaintext highlighter-rouge">url_for()</code>生成链接时再把前缀添加进去，完成闭环。</p>



                <hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2023/03/04/8b10b_Encoding/" data-toggle="tooltip" data-placement="top" title="8b10b编码">
                        Previous<br>
                        <span>8b10b编码</span>
                        </a>
                    </li>
                    
                    
                </ul>


                

                
            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
                				<a href="/tags/#MATLAB" title="MATLAB" rel="4">
                                    MATLAB
                                </a>
                            
        				
                            
                				<a href="/tags/#PLL" title="PLL" rel="11">
                                    PLL
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Programing" title="Programing" rel="4">
                                    Programing
                                </a>
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#Math" title="Math" rel="2">
                                    Math
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Others" title="Others" rel="2">
                                    Others
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Flask" title="Flask" rel="2">
                                    Flask
                                </a>
                            
        				
                            
        				
                            
                				<a href="/tags/#Training" title="Training" rel="2">
                                    Training
                                </a>
                            
        				
                            
                				<a href="/tags/#SerDes" title="SerDes" rel="2">
                                    SerDes
                                </a>
                            
        				
                            
        				
                            
        				
                            
        				
                            
                				<a href="/tags/#ChatGPT" title="ChatGPT" rel="2">
                                    ChatGPT
                                </a>
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
                <hr>
                <h5>FRIENDS</h5>
                <ul class="list-inline">
                    
                        <li><a href="#">(none)</a></li>
                    
                </ul>
                
            </div>
        </div>
    </div>
</article>









<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<!--
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'always',
          placement: 'right',
          icon: '#'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
-->
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    
                    

                    <!-- add Weibo, Zhihu by Hux, add target = "_blank" to <a> by Hux -->
                    
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/(none)">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="http://weibo.com/(none)">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-weibo fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    


                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/(none)">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/in/%E6%98%AD%E9%91%AB-%E9%A9%AC-96023bb7">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; MaZhaoxin's Blog 2024
                    <br>
					Powered by <a href="https://jekyllrb.com/" style="font-weight: bold">Jekyll</a> |
					Themed by <a href="http://huangxuan.me" style="font-weight: bold">Hux</a> |
					Hosted by <a href="https://pages.github.com/" style="font-weight: bold">GitHub Pages</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<!-- <script src="/js/jquery.min.js "></script> -->
<script src="//cdn.staticfile.org/jquery/2.1.3/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<!-- Currently, only navbar scroll-down effect at desktop still depends on this -->
<!-- <script src="/js/bootstrap.min.js "></script> -->
<script src="//cdn.staticfile.org/twitter-bootstrap/3.3.2/js/bootstrap.min.js"></script>


<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js "></script>

<!-- Service Worker -->


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdn.staticfile.org/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>

<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {

        // interop with multilangual 
        if ('' == 'true') {
            _containerSelector = 'div.post-container.active'
        } else {
            _containerSelector = 'div.post-container'
        }

        // init
        var P = $(_containerSelector),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        // clean
        $(selector).html('')

        // appending
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>



<!-- Multi-Lingual -->


<!-- Jekyll Search -->
<div class="cb-search-tool" style="position: fixed; top: 0px ; bottom: 0px; left: 0px; right:  0px;
      opacity: 0.95; background-color: #111111; z-index: 9999; display: none;">
    <input type="text" class="form-control cb-search-content" id="cb-search-content" style="position: fixed; top: 60px" placeholder="Title / Date / Tags" >

    <div style="position: fixed; top: 16px; right: 16px;">
        <img src="/search/img/cb-close.png"  id="cb-close-btn"/>
    </div>
</div>

<link rel="stylesheet" href="/search/css/cb-search.css">

<script src="/search/js/bootstrap3-typeahead.min.js"></script>
<script src="/search/js/cb-search.js"></script>


</body>

</html>
